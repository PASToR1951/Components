<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PeAS - Login</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    <style>
        /* CSS Variables from DocumentSummary.html */
        :root {
            --theme-gold: #FDB813;
            --theme-gold-darker: #EAA10F;
            --theme-gold-light-bg: rgba(253, 184, 19, 0.2);
            --theme-gold-lighter-bg: rgba(253, 184, 19, 0.1); /* Used for graphic column */
            --theme-green-dark: #006A4E;
            --theme-green-darker: #00523D; /* Darker green for hover/text */
            --theme-green-light-bg: rgba(0, 106, 78, 0.3);
            --theme-green-lighter-bg: rgba(0, 106, 78, 0.15);
            --theme-green-border: rgba(0, 106, 78, 0.7);
            --theme-page-bg: #F9F6EE;
            --neutral-border-color: #e5e7eb;
            --input-border-color: #d1d5db; /* Fallback, overridden by theme */
            --placeholder-text-color: #9ca3af;
            --text-on-gold: #000000;
            --text-on-green: #FFFFFF;
            --primary-text-color: #1f2937;
            --secondary-text-color: #4b5563;
            --tertiary-text-color: #6b7280;
        }

        /* Reset and Basic Styles */
        *, *::before, *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--theme-page-bg);
            background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23D3CBBF' fill-opacity='0.1'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
            color: var(--primary-text-color);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .main-container {
            display: flex;
            width: 100%;
            max-width: 1200px;
            min-height: 90vh;
            max-height: 700px;
            background-color: #FFFFFF;
            border-radius: 24px;
            box-shadow: 0px 20px 40px rgba(0, 0, 0, 0.08);
            overflow: visible; 
            margin: 20px;
        }

        .form-column {
            flex: 1 1 55%;
            padding: 40px 60px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            background-color: #FFFFFF; 
            border-radius: 24px 0 0 24px; 
            position: relative; 
            box-shadow: 5px 0px 15px -5px rgba(0, 0, 0, 0.07);
            z-index: 2; 
        }

        .graphic-column {
            flex: 1 1 45%;
            background-color: var(--theme-gold-lighter-bg);
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            border-radius: 0 24px 24px 0; 
            z-index: 1; 
            animation: subtleBackgroundShift 30s ease-in-out infinite alternate;
        }
        @keyframes subtleBackgroundShift {
            0% { background-color: var(--theme-gold-lighter-bg); }
            50% { background-color: rgba(253, 190, 30, 0.1); } 
            100% { background-color: var(--theme-gold-lighter-bg); }
        }


        /* Blob styles */
        .blob-container {
            width: 280px; 
            height: 280px;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1; 
        }
        .blob-interactive-wrapper { 
            width: 100%;
            height: 100%;
            will-change: transform;
        }

        .blob { 
            width: 100%; 
            height: 100%;
            background: radial-gradient(circle at center, 
                var(--theme-gold) 0%, 
                rgba(253, 184, 19, 0.7) 40%, 
                rgba(253, 184, 19, 0.3) 70%, 
                rgba(253, 184, 19, 0.0) 100%
            );
            border-radius: 30% 70% 70% 30% / 30% 30% 70% 70%; 
            filter: blur(6px); 
            opacity: 0.85;
        }

        .icons-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 3; 
        }

        .icons-overlay .icon {
            position: absolute;
            color: rgba(224, 161, 15, 0.65);
            opacity: 0; 
            transform-origin: center center;
            will-change: transform, opacity;
            transition: transform 0.2s cubic-bezier(0.34, 1.56, 0.64, 1); 
            pointer-events: none;
            display: none; 
        }
        .icons-overlay .icon.icon-active {
            display: block; 
        }

        /* Varied icon sizes for desktop */
        .icons-overlay .icon-1 { font-size: 22px; }
        .icons-overlay .icon-2 { font-size: 30px; }
        .icons-overlay .icon-3 { font-size: 20px; }
        .icons-overlay .icon-4 { font-size: 32px; }
        .icons-overlay .icon-5 { font-size: 24px; }
        .icons-overlay .icon-6 { font-size: 26px; }
        .icons-overlay .icon-7 { font-size: 22px; }
        .icons-overlay .icon-8 { font-size: 28px; }
        .icons-overlay .icon-9 { font-size: 24px; }
        .icons-overlay .icon-10 { font-size: 20px; }


        .header-logo {
            display: flex;
            align-items: center;
            margin-bottom: 30px;
            position: relative; 
            cursor: default; 
        }

        .logo-image {
            width: 52px;
            height: 52px;
            object-fit: contain;
            margin-right: 12px;
            flex-shrink: 0;
            border-radius: 4px;
            will-change: transform; 
            transition: transform 0.15s ease-out; 
        }
        .logo-image-fallback {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 52px;
            height: 52px;
            background-color: var(--theme-green-dark);
            color: var(--text-on-green);
            border-radius: 8px;
            margin-right: 12px;
            font-size: 1.1em;
            font-weight: 700;
            border: 2px solid var(--theme-gold);
            text-align: center;
            line-height: 1;
            will-change: transform;
            transition: transform 0.15s ease-out;
        }


        .logo-text {
            font-size: 18px;
            font-weight: 600;
            color: var(--primary-text-color);
            line-height: 1.3;
        }
         .logo-text span {
            font-weight: 700;
            color: var(--theme-green-dark);
        }


        .form-content {
            position: relative; /* Needed for absolute positioning of forms if used */
            /* min-height: 350px; /* Adjust to fit the tallest form to prevent jitter */
        }
        
        #login-form, #forgot-password-form {
            width: 100%;
            transition: opacity 0.35s ease-in-out, transform 0.35s ease-in-out, max-height 0.45s ease-in-out,
                        margin 0.35s ease-in-out, padding 0.35s ease-in-out;
            transform-origin: top center;
            overflow: hidden; /* Default to hidden, JS/CSS will make active visible */
        }

        /* Default state for forms (when not hidden) */
        #login-form:not(.hidden), #forgot-password-form:not(.hidden) {
            opacity: 1;
            transform: translateY(0px) scale(1);
            max-height: 500px; /* Adjust if form content is taller */
            overflow: visible; /* Allow content to be seen */
        }
        
        /* Styles for the .hidden class specifically for forms within .form-content */
        .form-content > form.hidden {
            opacity: 0 !important;
            transform: translateY(15px) scale(0.98) !important; /* Slide down and shrink slightly */
            max-height: 0px !important; /* Collapse height */
            overflow: hidden !important;
            pointer-events: none !important;
            margin-top: 0 !important; 
            margin-bottom: 0 !important;
            padding-top: 0 !important; 
            padding-bottom: 0 !important;
            border-width: 0 !important; 
        }


        .form-content h1 {
            font-size: 28px;
            font-weight: 700;
            color: var(--primary-text-color);
            margin-bottom: 8px;
        }

        .form-content p.subtitle {
            font-size: 16px;
            color: var(--secondary-text-color);
            margin-bottom: 32px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            color: var(--secondary-text-color);
            margin-bottom: 6px;
        }

        .form-group input[type="text"],
        .form-group input[type="password"],
        .form-group input[type="email"] {
            width: 100%;
            padding: 12px 14px;
            border: 1px solid var(--theme-green-border);
            border-radius: 8px;
            font-size: 16px;
            color: var(--primary-text-color);
            background-color: #FFFFFF;
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }

        .form-group input::placeholder {
            color: var(--placeholder-text-color);
        }

        .form-group input:focus {
            outline: none;
            border-color: var(--theme-green-dark);
            box-shadow: 0 0 0 3px var(--theme-green-light-bg);
        }

        .options-row {
            display: flex;
            justify-content: flex-end;
            align-items: center;
            margin-bottom: 24px;
            font-size: 14px;
        }

        .options-row a {
            color: var(--theme-green-dark);
            font-weight: 600;
            text-decoration: none;
            transition: color 0.2s ease;
        }

        .options-row a:hover {
            color: var(--theme-green-darker);
            text-decoration: underline;
        }

        button {
            width: 100%;
            padding: 12px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s ease, transform 0.1s ease, border-color 0.2s ease;
            border: 1px solid transparent;
        }

        button.btn-primary {
            background-color: var(--theme-green-dark);
            color: var(--text-on-green);
            border-color: var(--theme-green-dark);
            margin-bottom: 24px;
        }

        button.btn-primary:hover {
            background-color: var(--theme-green-darker);
            border-color: var(--theme-green-darker);
        }
        button.btn-primary:active {
            transform: scale(0.99);
        }

        .footer-text {
            font-size: 12px;
            color: var(--tertiary-text-color);
            padding-top: 20px;
            line-height: 1.5;
        }

        /* .hidden class is now more specific for forms or needs to be globally safe if display:none is removed */
        /* For general purpose, if display:none is needed elsewhere, it should be a different class */
        /* The .form-content > form.hidden handles form-specific hiding with transitions */


        @media (max-width: 900px) {
            .main-container { flex-direction: column; max-height: none; min-height: 100vh; border-radius: 0; margin: 0; overflow: hidden; }
            .form-column { padding: 40px 30px; order: 1; justify-content: flex-start; flex-grow: 1; border-radius: 0; box-shadow: none; z-index: auto; }
            .graphic-column { min-height: 200px; max-height: 250px; order: 0; flex-basis: auto; border-radius: 0; z-index: auto; }
            
            .blob-container { width: 200px; height: 200px; }

            .icons-overlay .icon-1 { font-size: 18px; }
            .icons-overlay .icon-2 { font-size: 24px; }
            .icons-overlay .icon-3 { font-size: 16px; }
            .icons-overlay .icon-4 { font-size: 26px; }
            .icons-overlay .icon-5 { font-size: 20px; }


            .form-content h1 { font-size: 26px; }
            .form-content p.subtitle { margin-bottom: 24px; }
            .logo-text { font-size: 17px; }
            .logo-image { width: 48px; height: 48px; }
            .logo-image-fallback { width: 48px; height: 48px; font-size: 1.05em; }
            .footer-text { text-align: center; margin-top: 30px; padding-bottom: 20px; }
        }

        @media (max-width: 480px) {
            .form-column { padding: 30px 20px; }
            .graphic-column { min-height: 150px; max-height: 180px; }
            .blob-container { width: 150px; height: 150px; }


            .icons-overlay .icon-1 { font-size: 14px; }
            .icons-overlay .icon-2 { font-size: 18px; }
            .icons-overlay .icon-3 { font-size: 12px; }


            .form-content h1 { font-size: 22px; }
            .form-content p.subtitle { font-size: 15px; margin-bottom: 20px; }
            .header-logo { margin-bottom: 24px; }
            .logo-text { font-size: 15px; }
            .logo-image { width: 44px; height: 44px; }
            .logo-image-fallback { width: 44px; height: 44px; font-size: 1em; }
            .options-row { margin-bottom: 20px; }
            button.btn-primary { padding: 10px; font-size: 15px; margin-bottom: 20px; }
            .form-group input[type="text"],
            .form-group input[type="password"],
            .form-group input[type="email"] { padding: 10px 12px; font-size: 15px; }
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="main-container">
        <div class="form-column">
            <div> <div class="header-logo">
                    <img src="https://www.spud.edu.ph/assets/logo/spud_logo_s.png" alt="PeAS Logo" class="logo-image"
                         onerror="this.style.display='none'; document.getElementById('logo-fallback').style.display='inline-flex';">
                    <div id="logo-fallback" class="logo-image-fallback" style="display:none;">PeAS</div>
                    <div class="logo-text">Paulinian electronic<br>Archiving System <span>(PeAS)</span></div>
                </div>
                <div class="form-content">
                    <h1 id="form-title-main">Welcome back</h1>
                    <p class="subtitle" id="form-subtitle">Please enter your details to access the PeAS.</p>
                    <form id="login-form" action="#" method="post">
                        <div class="form-group">
                            <label for="username">Email</label>
                            <input type="email" id="username" name="username" required placeholder="Enter your email">
                        </div>
                        <div class="form-group">
                            <label for="password">Password</label>
                            <input type="password" id="password" name="password" required placeholder="••••••••">
                        </div>
                        <div class="options-row">
                            <a href="#" id="forgot-password-link">Forgot Password?</a>
                        </div>
                        <button type="submit" class="btn-primary">Sign in</button>
                    </form>
                    <form id="forgot-password-form" action="#" method="post" class="hidden">
                        <div class="form-group">
                            <label for="email-forgot">Enter your Registered Email</label>
                            <input type="email" id="email-forgot" name="email" required placeholder="e.g., user@example.com">
                        </div>
                        <button type="submit" class="btn-primary">Send Reset Link</button>
                        <div class="options-row" style="justify-content: center; margin-top: 20px;">
                             <a href="#" id="back-to-login-link">Back to Login</a>
                        </div>
                    </form>
                </div>
            </div>
            <div class="footer-text">
                © <span id="currentYear"></span> PeAS. All Rights Reserved. <br>L. Rovira Rd, Bantayan, Dumaguete, Negros Oriental.
            </div>
        </div>
        <div class="graphic-column">
            <div class="blob-container">
                <div class="blob-interactive-wrapper">
                    <div class="blob"></div>
                </div>
            </div>
            <div class="icons-overlay">
                <i class="fas fa-archive icon icon-1"></i>
                <i class="fas fa-file-alt icon icon-2"></i>
                <i class="fas fa-search icon icon-3"></i>
                <i class="fas fa-shield-alt icon icon-4"></i>
                <i class="fas fa-book icon icon-5"></i>
                <i class="fas fa-folder-open icon icon-6"></i>
                <i class="fas fa-cogs icon icon-7"></i>
                <i class="fas fa-key icon icon-8"></i>
                <i class="fas fa-link icon icon-9"></i>
                <i class="fas fa-history icon icon-10"></i>
            </div>
        </div>
    </div>
    <script>
        // Form toggle script
        const loginForm = document.getElementById('login-form');
        const forgotPasswordForm = document.getElementById('forgot-password-form');
        const forgotPasswordLink = document.getElementById('forgot-password-link');
        const backToLoginLink = document.getElementById('back-to-login-link');
        const formTitleMain = document.getElementById('form-title-main');
        const formSubtitle = document.getElementById('form-subtitle');

        forgotPasswordLink.addEventListener('click', function(event) {
            event.preventDefault();
            loginForm.classList.add('hidden'); // This will trigger CSS transition to hide
            forgotPasswordForm.classList.remove('hidden'); // This will trigger CSS transition to show
            formTitleMain.textContent = 'Forgot Password?';
            formSubtitle.textContent = 'No worries, we’ll send you reset instructions.';
        });

        backToLoginLink.addEventListener('click', function(event) {
            event.preventDefault();
            forgotPasswordForm.classList.add('hidden'); // This will trigger CSS transition to hide
            loginForm.classList.remove('hidden'); // This will trigger CSS transition to show
            formTitleMain.textContent = 'Welcome back';
            formSubtitle.textContent = 'Please enter your details to access the PeAS.';
        });

        const yearSpan = document.getElementById('currentYear');
        if(yearSpan) {
            yearSpan.textContent = new Date().getFullYear();
        }

        // Interactive Icons and Blob Script
        document.addEventListener('DOMContentLoaded', () => {
            const graphicColumn = document.querySelector('.graphic-column');
            const allIconElements = Array.from(document.querySelectorAll('.icons-overlay .icon'));
            const blobInteractiveWrapper = document.querySelector('.graphic-column .blob-interactive-wrapper');
            const blobElement = document.querySelector('.graphic-column .blob');
            const headerLogoContainer = document.querySelector('.header-logo');
            const logoImage = document.querySelector('.logo-image');
            const logoFallback = document.getElementById('logo-fallback');


            if (!graphicColumn || allIconElements.length === 0 || !blobInteractiveWrapper || !blobElement || !headerLogoContainer || (!logoImage && !logoFallback)) {
                console.warn("Required elements for interaction not found.");
                return;
            }

            // Animate Blob with Anime.js
            function animateBlob() {
                anime.timeline({
                    targets: blobElement,
                    loop: true,
                    easing: 'easeInOutSine',
                    direction: 'alternate',
                })
                .add({
                    borderRadius: ['40% 60% 70% 30% / 40% 50% 50% 60%', '70% 30% 50% 50% / 30% 70% 40% 60%'],
                    duration: 5000
                })
                .add({
                    borderRadius: '50% 50% 30% 70% / 60% 40% 70% 30%',
                    duration: 5000
                })
                .add({
                    borderRadius: '30% 70% 60% 40% / 70% 30% 50% 50%',
                    duration: 5000
                });

                anime({
                    targets: blobElement,
                    scale: [
                        { value: 0.95, duration: 6000, easing: 'easeInOutQuad' },
                        { value: 1.05, duration: 6000, easing: 'easeInOutQuad' }
                    ],
                    rotate: [
                        { value: -3, duration: 6000, easing: 'easeInOutQuad' },
                        { value: 3, duration: 6000, easing: 'easeInOutQuad' }
                    ],
                    loop: true,
                    direction: 'alternate',
                    delay: 500 
                });
            }
            animateBlob();


            const MIN_TARGET_ACTIVE_ICONS = 5;
            const MAX_TARGET_ACTIVE_ICONS = 9;
            const TARGET_ACTIVE_ICONS = Math.floor(Math.random() * (MAX_TARGET_ACTIVE_ICONS - MIN_TARGET_ACTIVE_ICONS + 1)) + MIN_TARGET_ACTIVE_ICONS;
            const MIN_ICON_SEPARATION = 70;
            let activeIconData = []; 

            let graphicColumnCenterX = 0;
            let graphicColumnCenterY = 0;
            let baseExclusionRadius = 0; 
            let graphicColumnRect = graphicColumn.getBoundingClientRect();

            function calculateDimensions() {
                graphicColumnRect = graphicColumn.getBoundingClientRect();
                graphicColumnCenterX = graphicColumnRect.width / 2;
                graphicColumnCenterY = graphicColumnRect.height / 2;
                baseExclusionRadius = (parseFloat(getComputedStyle(blobElement).width) || 280) / 2 * 0.7;
            }

            calculateDimensions();
            window.addEventListener('resize', calculateDimensions);

            function isPositionValid(x, y, iconRadius, currentIconElement) {
                const dxToCircleCenter = x - graphicColumnCenterX;
                const dyToCircleCenter = y - graphicColumnCenterY;
                const distToCircleCenter = Math.sqrt(dxToCircleCenter * dxToCircleCenter + dyToCircleCenter * dyToCircleCenter);
                const exclusionRadiusWithBuffer = baseExclusionRadius + iconRadius + 30;
                if (distToCircleCenter < exclusionRadiusWithBuffer) {
                    return false;
                }

                for (const activeIcon of activeIconData) {
                    if (activeIcon.element === currentIconElement || !activeIcon.element.style.opacity || parseFloat(activeIcon.element.style.opacity) === 0) {
                        continue;
                    }
                    const otherIconCenterX = parseFloat(activeIcon.element.dataset.originalLeft) + activeIcon.radius;
                    const otherIconCenterY = parseFloat(activeIcon.element.dataset.originalTop) + activeIcon.radius;
                    const dxToOtherIcon = x - otherIconCenterX;
                    const dyToOtherIcon = y - otherIconCenterY;
                    const distToOtherIcon = Math.sqrt(dxToOtherIcon * dxToOtherIcon + dyToOtherIcon * dyToOtherIcon);
                    if (distToOtherIcon < (iconRadius + activeIcon.radius + MIN_ICON_SEPARATION)) {
                        return false;
                    }
                }
                return true;
            }

            function spawnIcon(iconElement) {
                iconElement.classList.remove('icon-active'); 
                iconElement.style.opacity = '0'; 
                iconElement.style.transform = 'translate(0px, 0px) rotate(0deg) scale(1)';
                
                const iconComputedStyle = getComputedStyle(iconElement);
                const iconFontSize = parseFloat(iconComputedStyle.fontSize) || 24;
                const iconRadius = iconFontSize / 2;

                let newTop, newLeft, newCenterX, newCenterY;
                let attempts = 0;
                const maxAttempts = 100;

                do {
                    const paddingWidth = 0.10 * graphicColumnRect.width;
                    const paddingHeight = 0.10 * graphicColumnRect.height;
                    const iconWidth = iconElement.offsetWidth || iconFontSize;
                    const iconHeight = iconElement.offsetHeight || iconFontSize;
                    const effectiveSpawnWidth = graphicColumnRect.width - 2 * paddingWidth - iconWidth;
                    const effectiveSpawnHeight = graphicColumnRect.height - 2 * paddingHeight - iconHeight;

                    newLeft = paddingWidth + Math.random() * Math.max(0, effectiveSpawnWidth);
                    newTop = paddingHeight + Math.random() * Math.max(0, effectiveSpawnHeight);
                    newCenterX = newLeft + iconWidth / 2;
                    newCenterY = newTop + iconHeight / 2;
                    attempts++;
                } while (!isPositionValid(newCenterX, newCenterY, iconRadius, iconElement) && attempts < maxAttempts);
                
                if (attempts >= maxAttempts) {
                    newLeft = (iconRadius + 10) + (Math.random() * 20 - 10) ;
                    newTop = (iconRadius + 10) + (Math.random() * 20 - 10);
                }

                iconElement.style.left = `${newLeft}px`;
                iconElement.style.top = `${newTop}px`;
                iconElement.dataset.originalLeft = newLeft;
                iconElement.dataset.originalTop = newTop;
                
                iconElement.style.display = 'block'; 

                const targetOpacity = 0.3 + Math.random() * 0.6; 

                anime({
                    targets: iconElement,
                    opacity: [0, targetOpacity], // Animate from 0 to targetOpacity
                    scale: [0.8, 1], 
                    duration: 700, // Duration of the fade-in
                    easing: 'easeOutQuad',
                    begin: function() {
                        iconElement.classList.add('icon-active'); // Mark as active
                    }
                });


                const lifetime = (7 + Math.random() * 5) * 1000;
                const timeoutId = setTimeout(() => manageSpecificIcon(iconElement), lifetime);
                
                let existingIconData = activeIconData.find(d => d.element === iconElement);
                if (existingIconData) {
                    clearTimeout(existingIconData.lifetimeTimeoutId);
                    existingIconData.lifetimeTimeoutId = timeoutId;
                    existingIconData.originalLeft = newLeft;
                    existingIconData.originalTop = newTop;
                    existingIconData.radius = iconRadius;
                } else {
                     activeIconData.push({ element: iconElement, lifetimeTimeoutId: timeoutId, originalLeft: newLeft, originalTop: newTop, radius: iconRadius });
                }
            }
            
            function manageSpecificIcon(iconElementToReplace) {
                 if (iconElementToReplace) {
                    anime({
                        targets: iconElementToReplace,
                        opacity: 0, // Animate to opacity 0
                        scale: 0.8, 
                        duration: 700, // Duration of the fade-out
                        easing: 'easeInQuad',
                        complete: function() {
                            iconElementToReplace.style.display = 'none'; 
                            iconElementToReplace.classList.remove('icon-active'); 
                            activeIconData = activeIconData.filter(d => d.element !== iconElementToReplace);
                            
                            if (activeIconData.length < TARGET_ACTIVE_ICONS) {
                                const availableIcons = allIconElements.filter(el => !activeIconData.some(d => d.element === el));
                                if (availableIcons.length > 0) {
                                    const nextIcon = availableIcons[Math.floor(Math.random() * availableIcons.length)];
                                    spawnIcon(nextIcon);
                                }
                            }
                        }
                    });
                }
            }

            let iconsToSpawnInitially = [...allIconElements];
            for (let i = 0; i < TARGET_ACTIVE_ICONS && iconsToSpawnInitially.length > 0; i++) {
                const randomIndex = Math.floor(Math.random() * iconsToSpawnInitially.length);
                const iconToSpawn = iconsToSpawnInitially.splice(randomIndex, 1)[0];
                spawnIcon(iconToSpawn);
            }

            let currentBlobAnimation = null; 
            let currentLogoAnimation = null;


            // Mouse move listener for the entire graphic column (for blob and icons)
            graphicColumn.addEventListener('mousemove', (e) => {
                const mouseX = e.clientX - graphicColumnRect.left;
                const mouseY = e.clientY - graphicColumnRect.top;

                // Blob interaction
                const blobInteractionRadius = (parseFloat(getComputedStyle(blobElement).width) || 280) / 2 * 1.2; 
                const deltaXBlob = mouseX - graphicColumnCenterX;
                const deltaYBlob = mouseY - graphicColumnCenterY;
                const distToBlobCenter = Math.sqrt(deltaXBlob * deltaXBlob + deltaYBlob * deltaYBlob);
                
                let blobRepelX = 0;
                let blobRepelY = 0;
                let blobScaleEffect = 1;

                if (distToBlobCenter < blobInteractionRadius && distToBlobCenter > 0) {
                    const blobMoveFactor = Math.max(0, (blobInteractionRadius - distToBlobCenter) / blobInteractionRadius);
                    const blobMaxMove = 10; 
                    blobRepelX = (deltaXBlob / distToBlobCenter) * blobMaxMove * blobMoveFactor * -1;
                    blobRepelY = (deltaYBlob / distToBlobCenter) * blobMaxMove * blobMoveFactor * -1;
                    blobScaleEffect = 1 - (blobMoveFactor * 0.05); 
                }
                
                if (currentBlobAnimation) currentBlobAnimation.pause();
                currentBlobAnimation = anime({
                    targets: blobInteractiveWrapper,
                    translateX: blobRepelX,
                    translateY: blobRepelY,
                    scale: blobScaleEffect,
                    duration: 300, 
                    easing: 'easeOutElastic(1, .6)'
                });


                // Icon interaction
                activeIconData.forEach(iconData => {
                    const icon = iconData.element;
                    // Check current opacity directly from style, not just class.
                    const currentOpacity = parseFloat(getComputedStyle(icon).opacity);
                    if (!icon.classList.contains('icon-active') || currentOpacity < 0.1) return;


                    const iconRect = icon.getBoundingClientRect();
                    const iconVisualCenterX = (iconRect.left - graphicColumnRect.left) + (iconRect.width / 2);
                    const iconVisualCenterY = (iconRect.top - graphicColumnRect.top) + (iconRect.height / 2);
                    
                    const originalCenterX = parseFloat(icon.dataset.originalLeft) + (iconRect.width / 2);
                    const originalCenterY = parseFloat(icon.dataset.originalTop) + (iconRect.height / 2);

                    const deltaXIcon = mouseX - iconVisualCenterX;
                    const deltaYIcon = mouseY - iconVisualCenterY;
                    
                    const maxDistIcon = 150; 
                    const distToMouseIcon = Math.sqrt(deltaXIcon * deltaXIcon + deltaYIcon * deltaYIcon);
                    const moveFactorIcon = Math.max(0, (maxDistIcon - distToMouseIcon) / maxDistIcon); 
                    
                    const maxMoveIcon = 18; 
                    
                    let moveX = 0;
                    let moveY = 0;
                    let angleDeg = 0;
                    let scaleFactor = 1;
                    let jitterX = 0;
                    let jitterY = 0;

                    if (distToMouseIcon < maxDistIcon && distToMouseIcon > 0) {
                        moveX = (deltaXIcon / distToMouseIcon) * maxMoveIcon * moveFactorIcon * -1; 
                        moveY = (deltaYIcon / distToMouseIcon) * maxMoveIcon * moveFactorIcon * -1; 
                        
                        const angleToCursorRad = Math.atan2(deltaYIcon, deltaXIcon);
                        angleDeg = angleToCursorRad * (180 / Math.PI) * moveFactorIcon * 0.25; 
                        scaleFactor = 1 + moveFactorIcon * 0.15; 

                        if (moveFactorIcon > 0.1) { 
                           jitterX = (Math.random() - 0.5) * 4 * moveFactorIcon; 
                           jitterY = (Math.random() - 0.5) * 4 * moveFactorIcon;
                        }
                    }

                    let finalMoveX = moveX + jitterX;
                    let finalMoveY = moveY + jitterY;

                    let testCenterX = originalCenterX + finalMoveX;
                    let testCenterY = originalCenterY + finalMoveY;

                    const dxToCircleCenter = testCenterX - graphicColumnCenterX;
                    const dyToCircleCenter = testCenterY - graphicColumnCenterY;
                    const distToCircleCenter = Math.sqrt(dxToCircleCenter * dxToCircleCenter + dyToCircleCenter * dyToCircleCenter);
                    
                    const iconRadius = iconRect.width / 2; 
                    const currentExclusionRadius = baseExclusionRadius + iconRadius + 30; 

                    if (distToCircleCenter < currentExclusionRadius && distToCircleCenter > 0) {
                        const normDxToCircle = dxToCircleCenter / distToCircleCenter;
                        const normDyToCircle = dyToCircleCenter / distToCircleCenter;

                        const targetXOnEdge = graphicColumnCenterX + normDxToCircle * currentExclusionRadius;
                        const targetYOnEdge = graphicColumnCenterY + normDyToCircle * currentExclusionRadius;

                        finalMoveX = targetXOnEdge - originalCenterX;
                        finalMoveY = targetYOnEdge - originalCenterY;
                        
                        angleDeg *= 0.5; 
                        scaleFactor = 1 + (scaleFactor - 1) * 0.5;
                    }

                    icon.style.transform = `translate(${finalMoveX}px, ${finalMoveY}px) rotate(${angleDeg}deg) scale(${scaleFactor})`;
                });
            });

            graphicColumn.addEventListener('mouseleave', () => {
                 if (currentBlobAnimation) currentBlobAnimation.pause();
                 anime({
                    targets: blobInteractiveWrapper,
                    translateX: 0,
                    translateY: 0,
                    scale: 1,
                    duration: 500,
                    easing: 'easeOutQuad'
                 });
                 activeIconData.forEach(iconData => {
                    iconData.element.style.transform = 'translate(0px, 0px) rotate(0deg) scale(1)';
                 });
             });

            // Logo Interaction
            const logoTarget = logoImage && getComputedStyle(logoImage).display !== 'none' ? logoImage : logoFallback;
            if (logoTarget) {
                headerLogoContainer.addEventListener('mousemove', (e) => {
                    const logoRect = logoTarget.getBoundingClientRect();
                    const parentRect = headerLogoContainer.getBoundingClientRect();

                    // Mouse position relative to the headerLogoContainer
                    const mouseX = e.clientX - parentRect.left;
                    const mouseY = e.clientY - parentRect.top;

                    // Logo center relative to the headerLogoContainer
                    const logoCenterX = logoTarget.offsetLeft + logoRect.width / 2;
                    const logoCenterY = logoTarget.offsetTop + logoRect.height / 2;

                    const deltaX = mouseX - logoCenterX;
                    const deltaY = mouseY - logoCenterY;

                    const maxDistLogo = 100; // Interaction radius for logo
                    const dist = Math.sqrt(deltaX * deltaX + deltaY * deltaY);
                    const moveFactor = Math.max(0, (maxDistLogo - dist) / maxDistLogo);

                    const maxRotate = 8; // Max degrees for tilt
                    const maxScale = 1.08;

                    let rotateX = 0;
                    let rotateY = 0;
                    let scale = 1;

                    if (dist < maxDistLogo) {
                        rotateX = -(deltaY / logoRect.height) * maxRotate * 2 * moveFactor; // Invert Y for natural tilt
                        rotateY = (deltaX / logoRect.width) * maxRotate * 2 * moveFactor;
                        scale = 1 + (maxScale - 1) * moveFactor;
                    }
                    
                    if(currentLogoAnimation) currentLogoAnimation.pause();
                    currentLogoAnimation = anime({
                        targets: [logoImage, logoFallback],
                        rotateX: rotateX,
                        rotateY: rotateY,
                        scale: scale,
                        duration: 150,
                        easing: 'easeOutQuad'
                    });
                });

                headerLogoContainer.addEventListener('mouseleave', () => {
                    if(currentLogoAnimation) currentLogoAnimation.pause();
                    currentLogoAnimation = anime({
                        targets: [logoImage, logoFallback],
                        rotateX: 0,
                        rotateY: 0,
                        scale: 1,
                        duration: 300,
                        easing: 'easeOutElastic(1, .8)'
                    });
                });
            }

        });
    </script>
</body>
</html>
